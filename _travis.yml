language: r
r: 3.6.1
pandoc_version: 2.6
cache:
  packages: no

#before_install:
# install:

#before_script:
#  - chmod +x ./_build.sh
#  - chmod +x ./_deploy.sh

script:
  - Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::gitbook')"
  - Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::pdf_book')"
  - set -e
  - [ -z "${GITHUB_PAT}" ] && exit 0
  - [ "${TRAVIS_BRANCH}" != "master" ] && exit 0
  - git config --global user.email "andrew.beet@noaa.gov"
  - git config --global user.name "andybeet"
  - git clone -b gh-pages https://${GITHUB_PAT}@github.com/${TRAVIS_REPO_SLUG}.git book-output
  - cd book-output
  - cp -r ../_book/* ./
  - git add --all *
  - git commit -m"Update the book" || true
  - git push -q origin gh-pages
  
  
#after_success:
#after_failure:
#after_script:
#before_deploy:

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep_history: true
  local_dir: build
  on:
    branch: master

#after_deploy: